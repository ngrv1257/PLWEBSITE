<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | PadhnaLikhna</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Inter,Arial,sans-serif;
  background:linear-gradient(135deg,#1e3c72,#f5c542);
}

/* AUTH BOX */
.authBox{
  width:420px;
  max-width:95%;
  padding:28px;
  background:rgba(255,255,255,.25);
  backdrop-filter:blur(14px);
  border-radius:18px;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
}

h2{text-align:center;margin-bottom:12px;}

input{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
  border:none;
}

.passWrap{position:relative;}
.eye{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
}

canvas{
  width:100%;
  height:48px;
  border-radius:8px;
  background:#fff;
  margin-bottom:10px;
}

button{
  padding:12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.primary{background:#1e3c72;color:#fff;}
.secondary{background:#f5c542;color:#000;}

.btnRow{display:flex;gap:10px;}

.tc{font-size:13px;}
.msg{font-size:13px;text-align:center;color:#c00;}
.verify{font-size:13px;text-align:center;color:#1e3c72;}
</style>
</head>

<body>

<div class="authBox">

<h2 id="formTitle">Login</h2>

<input id="email" type="email" placeholder="Email">

<div class="passWrap">
  <input id="password" type="password" placeholder="Password">
  <span class="eye" onclick="togglePwd('password')">üëÅ</span>
</div>

<div class="passWrap" id="confirmWrap" style="display:none;">
  <input id="confirmPassword" type="password" placeholder="Confirm Password">
  <span class="eye" onclick="togglePwd('confirmPassword')">üëÅ</span>
</div>

<p style="text-align:right;font-size:13px;">
  <a href="#" onclick="forgotPassword()">Forgot password?</a>
</p>

<!-- CAPTCHA -->
<canvas id="captchaCanvas"></canvas>
<input id="captchaInput" placeholder="Enter CAPTCHA">
<button class="secondary" onclick="refreshCaptcha()">‚Üª Refresh</button>

<!-- TERMS -->
<label class="tc" id="tncWrap" style="display:none;">
  <input type="checkbox" id="acceptTnc">
  I accept the <a href="terms.html" target="_blank">Terms & Conditions</a>
</label>

<p id="verifyMsg" class="verify" style="display:none;">
  ‚úÖ Account created.<br>Verify your email to login.
</p>

<div class="btnRow">
  <button class="primary" id="submitBtn" onclick="submitForm()">Login</button>
  <button class="secondary" id="switchBtn" onclick="switchMode()">Create Account</button>
</div>

<p id="msg" class="msg"></p>

</div>

auth.onAuthStateChanged(user => {
  if (user && user.emailVerified) {
    // Already logged in ‚Üí go home
    window.location.href = "index.html";
  }
});


<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyA50_nDcVr1PllKi9aff6Awo4w7XQAs3qc",
  authDomain: "amarfont-converter.firebaseapp.com",
  projectId: "amarfont-converter"
});
const auth = firebase.auth();
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

/* STATE */
let isSignup=false,captchaValue="",captchaFails=0;

/* CAPTCHA */
function drawCaptcha(){
  const c=document.getElementById("captchaCanvas"),x=c.getContext("2d");
  c.width=300;c.height=50;
  x.fillStyle="#fff";x.fillRect(0,0,300,50);
  captchaValue="";
  const ch="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  for(let i=0;i<6;i++) captchaValue+=ch[Math.floor(Math.random()*ch.length)];
  for(let i=0;i<40;i++){
    x.fillStyle=`rgba(0,0,0,${Math.random()})`;
    x.fillRect(Math.random()*300,Math.random()*50,2,2);
  }
  x.textAlign="center";x.textBaseline="middle";
  [...captchaValue].forEach((c,i)=>{
    x.save();x.translate(40+i*40,25);
    x.rotate((Math.random()-.5)*.5);
    x.font="24px Arial";
    x.fillStyle="#1e3c72";
    x.fillText(c,0,0);x.restore();
  });
}
function refreshCaptcha(){captchaInput.value="";drawCaptcha();}

/* UI */
function togglePwd(id){
  const e=document.getElementById(id);
  e.type=e.type==="password"?"text":"password";
}
function showMsg(t){document.getElementById("msg").innerText=t;}

function switchMode(){
  isSignup=!isSignup;
  formTitle.innerText=isSignup?"Create Account":"Login";
  submitBtn.innerText=isSignup?"Sign Up":"Login";
  switchBtn.innerText=isSignup?"Back to Login":"Create Account";
  confirmWrap.style.display=isSignup?"block":"none";
  tncWrap.style.display=isSignup?"block":"none";
  verifyMsg.style.display="none";
  showMsg("");refreshCaptcha();
}

/* AUTH */
function submitForm(){
  if(captchaInput.value.trim().toUpperCase()!==captchaValue){
    showMsg("Incorrect CAPTCHA");refreshCaptcha();return;
  }

  if(isSignup){
    if(password.value!==confirmPassword.value) return showMsg("Passwords do not match");
    if(!acceptTnc.checked) return showMsg("Accept Terms & Conditions");

    auth.createUserWithEmailAndPassword(email.value.trim(),password.value)
    .then(u=>{
      u.user.sendEmailVerification();
      verifyMsg.style.display="block";
      auth.signOut();
    })
    .catch(e=>showMsg(e.message));
    return;
  }

  auth.signInWithEmailAndPassword(email.value.trim(),password.value)
  .then(r=>{
    if(!r.user.emailVerified){
      auth.signOut();showMsg("Verify email first");return;
    }
    window.location.href="index.html";
  })
  .catch(()=>showMsg("Invalid email or password"));
}

function forgotPassword(){
  if(!email.value.trim()) return showMsg("Enter email first");
  auth.sendPasswordResetEmail(email.value.trim())
  .then(()=>showMsg("Password reset email sent"))
  .catch(e=>showMsg(e.message));
}

window.onload=drawCaptcha;
</script>

</body>
</html>
